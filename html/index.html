<!--

equatorie.html

 -->

<!doctype html>

<!--[if lt IE 7]> 
  <meta http-equiv="refresh" content="5;url=http://www.webstandards.org/action/previous-campaigns/buc/upgrade/" />
 <![endif]-->
<!--[if IE 7 ]>    <html class="ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="en"> <!--<![endif]-->
<head>
<title>Equatorie</title>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<meta name="description" content="">
<meta name="author" content="">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="/favicon.ico">

<link href="/css/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" />
<link href="/css/datepicker.css" media="all" rel="stylesheet" type="text/css" />
<link href="/css/equatorie.css" media="all" rel="stylesheet" type="text/css" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

</head>

<body>
    
<header>
</header>

<canvas id="webgl-canvas" style="border: none;" width="580" height="580"></canvas>

<!--<script type="text/javascript" src="/js/coffeegl.js"></script>-->
<script type="text/javascript" src="/js/dat.gui.min.js"></script>

<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="/js/equatorie.js"></script>

<!-- <script src="http://192.168.2.14:8080/target/target-script-min.js"></script> -->

<!-- Main Controls -->

<div id ="equatorie_text_left">
<a data-toggle="modal" href="#instructionsModal" class="btn btn-info">Instructions</a>


<!-- Date Picker -->

<input type="text" class="date input-append" value="31/12/1392" format="dd-mm-yyyy" id="dp1">

<!-- Buttons for the Actions we can perform -->
<div class="btn-group dropup" id="actionSelect">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
    Action <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
    <li><a href="#" id="selectMercury">Mercury Longitude</a></li>
    <li><a href="#" id="selectVenus">Venus Longitude</a></li>
    <li><a href="#" id="selectMars">Mars Longitude</a></li>
    <li><a href="#" id="selectJupiter">Jupiter Longitude</a></li>
    <li><a href="#" id="selectSaturn">Saturn Longitude</a></li>
    <li class="divider"></li>
    <li><a href="#" id="selectSun">Sun Longitude</a></li>
    <li><a href="#" id="selectMoon">Moon Longitude</a></li>
    <li class="divider"></li>
    <li><a href="#" id="selectMoonLat">Moon Latitude</a></li>
  </ul>
</div>



<button id="button_next" type="button" class="btn btn-primary">Next Step</button>
<button id="button_reset" type="button" class="btn btn-danger">Reset</button>

</div>


<!-- Loading bar -->
<div id ="equatorie_loading">
  <div class="progress progress-striped active">
  <div class="progress-bar" id ="loadingProgressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
    <span class="sr-only"></span>
  </div>
</div>
</div>


<!-- About Box -->
<div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">About</h4>
          <p>Equatorie reconstruction by Seb Falk (University of Cambridge) and Benjamin Blundell (<a href="http://www.section9.co.uk">section9.co.uk</a>).</p>

        </div>
        <div class="modal-body">
          <p>Credits
            <ul>
              <li>Built with <a href="http://www.coffeegl.com">CoffeeGL</a></li>
              <li>Physics provided by <a href="http://schteppe.github.io/cannon.js/">Cannon.js</a></li>
              <li>Normal maps by <a href="http://www.crazybump.com">CrazyBump</a></li>
              <li>Modelled in <a href="http://www.blender.org">Blender</a></li>
              <li>CSS, courtesy of <a href="http://getbootstrap.com">Twitter Bootstrap</a></li>
            </ul>
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->


<!-- Instructions -->

<div class="modal fade" id="instructionsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Instructions</h4>
        </div>
        <div class="modal-body">
          <p>
            To operate the Equatorie model, follow the steps:
            <ol>
              <li>Select a date using the the date picker widget at the bottom left of the screen.</li>
              <li>Choose an action, such as the longitude of Mars. The Next button will appear.</li>
              <li>Press the next button to step through the different stages of finding the longitude of mars.</li>
              <li>When you are finished (or at any time) you may press the reset button.</li>
            </ol>
          </p>
          <p>You can rotate the equatorie by holding down the left mouse button and moving the mouse. You may also use a finger on your touch-screen device. To zoom in and out, use the mouse wheel or the 'zoom' (or 'pinch') gesture on your touch screen device.</p>

          <p>You may move the strings by clicking and holding the mouse button over the pin attached to the string. To move the epicycle, click and hold the mouse over the epicycle, then move the mouse.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

</div>

<div id ="equatorie_text_right">
<a data-toggle="modal" id="buttonAbout" href="#aboutModal" class="btn btn-info">About</a>
</div>

<div id = "popupContainer">&nbsp;</div>


<script type="text/javascript">

loaded = function() {
  $('#equatorie_text_left').css({display: "block"});
  $('#equatorie_text_right').css({display: "block"});
  $('#equatorie_loading').css({display: "none"});

  window.EquatorieMovePOI.add(moving, this);
}

loading = function (loaded) {
  $('#loadingProgressBar').width(loaded * 100);
}

moving = function (pos) {

  // Alter the pos a little so its aligned nicely
  pos.x += 10;
  pos.y -= $(".popover").height() / 2;

  $container.css({
    position: 'absolute',
    left: pos.x,
    top: pos.y
  });

  $(".popover").css({
    left: pos.x,
    top: pos.y
  });
}

window.EquatorieLoadProgress.add (loading, this);
window.EquatorieLoaded.addOnce(loaded, this);

// Date Picker

$('#dp1').datepicker()
  .on('changeDate', function(ev){
    d = ev.date;
    d.setHours(d.getHours() + 12); // Go to midday on each day
    window.Equatorie.setDate(d);
  });


$('#dp1').on('change', function() {  
  var datetxt = $('#dp1').val();
  parts = datetxt.split("/");
  if (parts.length === 3){
    d = new Date(parseInt(parts[2]),parseInt(parts[1])-1, parseInt(parts[0]));
    if( isNaN( d.getTime())){
      $('#dp1').val("31/12/1392");
    } else {
      window.Equatorie.setDate(d);
    }
    
  } else {
     $('#dp1').val("31/12/1392");
  }
})

// Functions for selectors for the planets

$("#selectMercury").click(function(){
  window.Equatorie.chosen_planet = "mercury"; 
  $("#button_next").show();
  $("#button_reset").show();
});

$("#selectVenus").click(function(){
  window.Equatorie.chosen_planet = "venus";
  $("#button_next").show();
  $("#button_reset").show();
});

$("#selectMars").click(function(){
  window.Equatorie.chosen_planet = "mars";
  $("#button_next").show();
  $("#button_reset").show();
});

$("#selectJupiter").click(function(){
  window.Equatorie.chosen_planet = "jupiter";
  $("#button_next").show();
  $("#button_reset").show();
});

$("#selectSaturn").click(function(){
  window.Equatorie.chosen_planet = "saturn";
  $("#button_next").show();
  $("#button_reset").show();
});

$("#selectSun").click(function(){
  window.Equatorie.chosen_planet = "sun";
  $("#button_next").show();
  $("#button_reset").show();
});

$("#selectMoon").click(function(){
  window.Equatorie.chosen_planet = "moon";
  $("#button_next").show();
  $("#button_reset").show();
});

$("#selectMoonLat").click(function(){
  window.Equatorie.chosen_planet = "moon_latitude";
  $("#button_next").show();
  $("#button_reset").show();
});

   

var $container = $('#popupContainer');

var options = {
    trigger: 'manual',
    placement: 'right'
};

$('#button_next').click( function() {

  if(window.Equatorie !== undefined) {
    $("#actionSelect button:first-child").prop('disabled', true);
    $("#dp1").prop('disabled', true);


    nd = window.Equatorie.stepForward();

    if (nd.pos !== undefined){
      $container.css({
        position: 'absolute',
        left: nd.pos.x,
        top: nd.pos.y
      });
    }

    if (nd.text !== undefined){
      $container.popover('destroy');
    
      $container.popover($.extend({}, {
          content: nd.text
      }, options)).popover('show');


    } else {
      $container.popover('destroy');
   
    }

    if (window.Equatorie.stack_idx == window.Equatorie.stack.length - 1){
      $('#button_next').prop('disabled', true);
    }
    else {
      $('#button_next').prop('disabled', false);
    }

  }
});

$('#button_reset').click( function() {
  if(window.Equatorie !== undefined) {
    window.Equatorie.reset();
    $container.popover('destroy');
    $container.css({
      position: 'absolute',
      left: 0,
      top: 0
    });

    $("#button_next").hide();
    $("#button_reset").hide();
    $("#actionSelect button:first-child").prop('disabled', false);
    $('#button_next').prop('disabled', false);
    $("#dp1").prop('disabled', false);
  }
});


//using HTML5 for fullscreen (only newest Chrome + FF)
//$("#mycanvas")[0].webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT); //Chrome
//$("#mycanvas")[0].mozRequestFullScreen(); //Firefox


//now i want to cancel fullscreen
//document.webkitCancelFullScreen(); //Chrome
//document.mozCancelFullScreen(); //Firefox

</script>


</body>

</html>
